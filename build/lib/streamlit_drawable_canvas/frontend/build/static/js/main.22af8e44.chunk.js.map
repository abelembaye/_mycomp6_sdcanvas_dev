{"version":3,"sources":["components/CanvasToolbar.module.css","components/CanvasToolbar.tsx","components/UpdateStreamlit.tsx","DrawableCanvasState.tsx","lib/fabrictool.ts","lib/singlearrowhead.ts","lib/doublearrowhead.ts","lib/circle.ts","lib/coordinate.ts","lib/index.ts","lib/curve.ts","lib/text.ts","lib/freedraw.ts","lib/line.ts","lib/polygon.ts","lib/rect.ts","lib/transform.ts","lib/point.ts","DrawableCanvas.tsx","index.tsx","img/undo.png","img/bin.png","img/download.png"],"names":["module","exports","enabled","disabled","invertx","SquareIcon","_ref","imgUrl","altText","invertX","size","clickCallback","React","createElement","src","className","concat","styles","alt","title","height","width","onClick","defaultProps","CanvasToolbar","_ref2","topPosition","leftPosition","canUndo","canRedo","downloadCallback","undoCallback","redoCallback","resetCallback","iconElements","download","undo","bin","style","position","top","left","display","gap","zIndex","map","e","key","UpdateStreamlit","props","stCanvas","setStCanvas","useState","fabric","Canvas","debouncedStateToSend","useDebounce","value","delay","debouncedValue","setDebouncedValue","useEffect","handler","setTimeout","clearTimeout","stateToSendToStreamlit","stC","enableRetinaScaling","shouldSendToStreamlit","loadFromJSON","canvas","data","getContext","toDataURL","Streamlit","setComponentValue","getWidth","getHeight","raw","toObject","sendDataToStreamlit","id","canvasWidth","canvasHeight","NO_ACTION","shouldReloadCanvas","forceSendToStreamlit","RELOAD_CANVAS","SEND_TO_STREAMLIT","RELOAD_AND_SEND_TO_STREAMLIT","canvasStateReducer","state","action","type","isEmpty","currentState","history","undoStack","redoStack","initialState","isEqual","undoOverHistoryMaxCount","length","slice","Error","isUndoEmpty","CanvasStateContext","createContext","CanvasStateProvider","children","canvasState","dispatch","useReducer","saveState","useCallback","redo","forceStreamlitUpdate","resetState","Provider","FabricTool","constructor","this","_canvas","SingleArrowHeadTool","super","arguments","isMouseDown","strokeWidth","strokeColor","currentLine","Line","startCircle","Circle","singlearrow","Group","endTriangle","Triangle","configureCanvas","isDrawingMode","selection","forEachObject","o","selectable","evented","on","onMouseDown","onMouseMove","onMouseUp","onMouseOut","off","_clicked","pointer","getPointer","points","x","y","fill","stroke","originX","originY","add","set","x2","y2","remove","yy2","yy1","xx2","xx1","y1","x1","angle","Math","atan2","PI","renderAll","updatedgroup","doublearrow","startTriangle","setCoords","CircleTool","fillColor","currentCircle","currentStartX","currentStartY","_minRadius","linearDistance","point1","point2","xs","ys","sqrt","radius","_radius","max","CoordinateTool","horizontalLine","verticalLine","coordinateCircle","coordinatesTextX","coordinatesTextY","tempHorizontalLine","tempVerticalLine","tempCoordinateCircle","tempCoordinatesText","coordinates_group","tempCoordinates_group","scaleFactors","clearTemporaryObjects","button","drawLinesAndCoordinates","drawTemporaryLinesAndCoordinates","strokeDashArray","xx","yy","Text","toFixed","fontSize","tools","circle","curve","curvePath","Path","controlPoints","currentPath","_pathString","_start","push","linePath","generateCurvePathData","pop","d3","alpha","lineGenerator","coordinate","text","userInput","prompt","IText","freedraw","freeDrawingBrush","color","line","polygon","onMouseDoubleClick","i","_last_pt_idx","lastIndexOf","rect","currentRect","Rect","_minLength","transparentCorners","strokeUniform","noScaleCache","abs","_width","_height","singlearrowhead","doublearrowhead","DoubleArrowHeadTool","transform","args","handleDoubleClick","getActiveObject","point","displayRadius","withStreamlitConnection","backgroundColor","backgroundImageURL","realtimeUpdateStreamlit","drawingMode","initialDrawing","displayToolbar","setCanvas","stopContextMenu","fireRightClick","backgroundCanvas","setBackgroundCanvas","StaticCanvas","useContext","c","imgC","setFrameHeight","_getStreamlitBaseUrl","bgImage","Image","onload","drawImage","baseUrl","URLSearchParams","window","location","search","get","URL","origin","getStreamlitBaseUrl","cleanupToolEvents","toJSON","visibility","border","ReactDOM","render","StrictMode","DrawableCanvas","document","getElementById"],"mappings":"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","file":"static/js/main.22af8e44.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"enabled\":\"CanvasToolbar_enabled__3qejl\",\"disabled\":\"CanvasToolbar_disabled__375cH\",\"invertx\":\"CanvasToolbar_invertx__BrmIZ\"};","import React from \"react\"\n\nimport styles from \"./CanvasToolbar.module.css\"\n\nimport bin from \"../img/bin.png\"\nimport undo from \"../img/undo.png\"\nimport download from \"../img/download.png\"\n\ninterface SquareIconProps {\n  imgUrl: string\n  altText: string\n  invertX?: boolean\n  size: number\n  enabled: boolean\n  clickCallback: () => void\n}\n\nconst SquareIcon = ({\n  imgUrl,\n  altText,\n  invertX,\n  size,\n  enabled,\n  clickCallback,\n}: SquareIconProps) => (\n  <img\n    src={imgUrl}\n    className={`\n    ${enabled ? styles.enabled : styles.disabled} ${\n      invertX ? \"\" : styles.invertx\n    }\n    `}\n    alt={altText}\n    title={altText}\n    height={`${size}px`}\n    width={`${size}px`}\n    onClick={clickCallback}\n  />\n)\nSquareIcon.defaultProps = {\n  invertX: false,\n}\n\ninterface CanvasToolbarProps {\n  topPosition: number\n  leftPosition: number\n  canUndo: boolean\n  canRedo: boolean\n  downloadCallback: () => void\n  undoCallback: () => void\n  redoCallback: () => void\n  resetCallback: () => void\n}\n\nconst CanvasToolbar = ({\n  topPosition,\n  leftPosition,\n  canUndo,\n  canRedo,\n  downloadCallback,\n  undoCallback,\n  redoCallback,\n  resetCallback,\n}: CanvasToolbarProps) => {\n  const GAP_BETWEEN_ICONS = 4\n  const ICON_SIZE = 24\n\n  const iconElements = [\n    {\n      imgUrl: download,\n      altText: \"Send to Streamlit\",\n      invertX: false,\n      enabled: true,\n      clickCallback: downloadCallback,\n    },\n    {\n      imgUrl: undo,\n      altText: \"Undo\",\n      invertX: true,\n      enabled: canUndo,\n      clickCallback: canUndo ? undoCallback : () => {},\n    },\n    {\n      imgUrl: undo,\n      altText: \"Redo\",\n      invertX: false,\n      enabled: canRedo,\n      clickCallback: canRedo ? redoCallback : () => {},\n    },\n    {\n      imgUrl: bin,\n      altText: \"Reset canvas & history\",\n      invertX: false,\n      enabled: true,\n      clickCallback: resetCallback,\n    },\n  ]\n\n  return (\n    <div\n      style={{\n        position: \"absolute\",\n        top: topPosition + 4,\n        left: 0,\n        display: \"flex\",\n        gap: GAP_BETWEEN_ICONS,\n        zIndex: 20,\n      }}\n    >\n      {iconElements.map((e) => (\n        <SquareIcon\n          key={e.altText}\n          imgUrl={e.imgUrl}\n          altText={e.altText}\n          invertX={e.invertX}\n          size={ICON_SIZE}\n          enabled={e.enabled}\n          clickCallback={e.clickCallback}\n        />\n      ))}\n    </div>\n  )\n}\n\nexport default CanvasToolbar\n","import React, { useEffect, useState } from \"react\"\nimport { Streamlit } from \"streamlit-component-lib\"\nimport { fabric } from \"fabric\"\n\nconst DELAY_DEBOUNCE = 200\n\n/**\n * Download image and JSON data from canvas to send back to Streamlit\n */\nconst sendDataToStreamlit = (canvas: fabric.Canvas): void => {\n  const data = canvas\n    .getContext()\n    .canvas.toDataURL()\n  Streamlit.setComponentValue({\n    data: data,\n    width: canvas.getWidth(),\n    height: canvas.getHeight(),\n    raw: canvas.toObject(),\n  })\n}\n\n/**\n * This hook allows you to debounce any fast changing value.\n * The debounced value will only reflect the latest value when the useDebounce hook has not been called for the specified time period.\n * When used in conjunction with useEffect, you can easily ensure that expensive operations like API calls are not executed too frequently.\n * https://usehooks.com/useDebounce/\n * @param value value to debounce\n * @param delay delay of debounce in ms\n */\nconst useDebounce = (value: any, delay: number) => {\n  const [debouncedValue, setDebouncedValue] = useState(value)\n\n  useEffect(\n    () => {\n      // Update debounced value after delay\n      const handler = setTimeout(() => {\n        setDebouncedValue(value)\n      }, delay)\n\n      // Cancel the timeout if value changes (also on delay change or unmount)\n      // This is how we prevent debounced value from updating if value is changed ...\n      // .. within the delay period. Timeout gets cleared and restarted.\n      return () => {\n        clearTimeout(handler)\n      }\n    },\n    [value, delay] // Only re-call effect if value or delay changes\n  )\n  return debouncedValue\n}\n\ninterface UpdateStreamlitProps {\n  shouldSendToStreamlit: boolean\n  stateToSendToStreamlit: Object\n  canvasWidth: number\n  canvasHeight: number\n}\n\n/**\n * Canvas whose sole purpose is to draw current state\n * to send image data to Streamlit.\n * Put it in the background or make it invisible!\n */\nconst UpdateStreamlit = (props: UpdateStreamlitProps) => {\n  const [stCanvas, setStCanvas] = useState(new fabric.Canvas(\"\"))\n\n  // Debounce fast changing canvas states\n  // Especially when drawing lines and circles which continuously render while drawing\n  const debouncedStateToSend = useDebounce(\n    props.stateToSendToStreamlit,\n    DELAY_DEBOUNCE\n  )\n\n  // Initialize canvas\n  useEffect(() => {\n    const stC = new fabric.Canvas(\"canvas-to-streamlit\", {\n      enableRetinaScaling: false,\n    })\n    setStCanvas(stC)\n  }, [])\n\n  // Load state to canvas, then send content to Streamlit\n  useEffect(() => {\n    if (debouncedStateToSend && props.shouldSendToStreamlit) {\n      stCanvas.loadFromJSON(debouncedStateToSend, () => {\n        sendDataToStreamlit(stCanvas)\n      })\n    }\n  }, [stCanvas, props.shouldSendToStreamlit, debouncedStateToSend])\n\n  return (\n    <canvas\n      id=\"canvas-to-streamlit\"\n      width={props.canvasWidth}\n      height={props.canvasHeight}\n    />\n  )\n}\n\nexport default UpdateStreamlit\n","import React, {\n  createContext,\n  useReducer,\n  useContext,\n  useCallback,\n} from \"react\"\nimport { isEmpty, isEqual } from \"lodash\"\n\nconst HISTORY_MAX_COUNT = 100\n\ninterface CanvasHistory {\n  undoStack: Object[] // store previous canvas states\n  redoStack: Object[] // store undone canvas states\n}\n\ninterface CanvasAction {\n  shouldReloadCanvas: boolean // reload currentState into app canvas, on undo/redo\n  forceSendToStreamlit: boolean // send currentState back to Streamlit\n}\n\nconst NO_ACTION: CanvasAction = {\n  shouldReloadCanvas: false,\n  forceSendToStreamlit: false,\n}\n\nconst RELOAD_CANVAS: CanvasAction = {\n  shouldReloadCanvas: true,\n  forceSendToStreamlit: false,\n}\n\nconst SEND_TO_STREAMLIT: CanvasAction = {\n  shouldReloadCanvas: false,\n  forceSendToStreamlit: true,\n}\n\nconst RELOAD_AND_SEND_TO_STREAMLIT: CanvasAction = {\n  shouldReloadCanvas: true,\n  forceSendToStreamlit: true,\n}\n\ninterface CanvasState {\n  history: CanvasHistory\n  action: CanvasAction\n  initialState: Object // first currentState for app\n  currentState: Object // current canvas state as canvas.toJSON()\n}\n\ninterface Action {\n  type: \"save\" | \"undo\" | \"redo\" | \"reset\" | \"forceSendToStreamlit\"\n  state?: Object\n}\n\n/**\n * Reducer takes 5 actions: save, undo, redo, reset, forceSendToStreamlit\n *\n * On reset, clear everything, set initial and current state to cleared canvas\n *\n * On save:\n * - First, if there is no initial state, set it to current\n *   Since we don't reset history on component initialization\n *   As backgroundColor/image are applied after component init\n *   and wouldn't be stored in initial state\n * - If the sent state is same as current state, then nothing has changed so don't save\n * - Clear redo stack\n * - Push current state to undo stack, delete oldest if necessary\n * - Set new current state\n *\n * On undo:\n * - Push state to redoStack if it's not the initial\n * - Pop state from undoStack into current state\n *\n * On redo:\n * - Pop state from redoStack into current state\n *\n * For undo/redo/reset, set shouldReloadCanvas to inject currentState into user facing canvas\n */\nconst canvasStateReducer = (\n  state: CanvasState,\n  action: Action\n): CanvasState => {\n  switch (action.type) {\n    case \"save\":\n      if (!action.state) throw new Error(\"No action state to save\")\n      else if (isEmpty(state.currentState)) {\n        return {\n          history: {\n            undoStack: [],\n            redoStack: [],\n          },\n          action: { ...NO_ACTION },\n          initialState: action.state,\n          currentState: action.state,\n        }\n      } else if (isEqual(action.state, state.currentState))\n        return {\n          history: { ...state.history },\n          action: { ...NO_ACTION },\n          initialState: state.initialState,\n          currentState: state.currentState,\n        }\n      else {\n        const undoOverHistoryMaxCount =\n          state.history.undoStack.length >= HISTORY_MAX_COUNT\n        return {\n          history: {\n            undoStack: [\n              ...state.history.undoStack.slice(undoOverHistoryMaxCount ? 1 : 0),\n              state.currentState,\n            ],\n            redoStack: [],\n          },\n          action: { ...NO_ACTION },\n          initialState:\n            state.initialState == null\n              ? state.currentState\n              : state.initialState,\n          currentState: action.state,\n        }\n      }\n    case \"undo\":\n      if (\n        isEmpty(state.currentState) ||\n        isEqual(state.initialState, state.currentState)\n      ) {\n        return {\n          history: { ...state.history },\n          action: { ...NO_ACTION },\n          initialState: state.initialState,\n          currentState: state.currentState,\n        }\n      } else {\n        const isUndoEmpty = state.history.undoStack.length === 0\n        return {\n          history: {\n            undoStack: state.history.undoStack.slice(0, -1),\n            redoStack: [...state.history.redoStack, state.currentState],\n          },\n          action: { ...RELOAD_CANVAS },\n          initialState: state.initialState,\n          currentState: isUndoEmpty\n            ? state.currentState\n            : state.history.undoStack[state.history.undoStack.length - 1],\n        }\n      }\n    case \"redo\":\n      if (state.history.redoStack.length > 0) {\n        // TODO: test currentState empty too ?\n        return {\n          history: {\n            undoStack: [...state.history.undoStack, state.currentState],\n            redoStack: state.history.redoStack.slice(0, -1),\n          },\n          action: { ...RELOAD_CANVAS },\n          initialState: state.initialState,\n          currentState:\n            state.history.redoStack[state.history.redoStack.length - 1],\n        }\n      } else {\n        return {\n          history: { ...state.history },\n          action: { ...NO_ACTION },\n          initialState: state.initialState,\n          currentState: state.currentState,\n        }\n      }\n    case \"reset\":\n      if (!action.state) throw new Error(\"No action state to store in reset\")\n      return {\n        history: {\n          undoStack: [],\n          redoStack: [],\n        },\n        action: { ...RELOAD_AND_SEND_TO_STREAMLIT },\n        initialState: action.state,\n        currentState: action.state,\n      }\n    case \"forceSendToStreamlit\":\n      return {\n        history: { ...state.history },\n        action: { ...SEND_TO_STREAMLIT },\n        initialState: state.initialState,\n        currentState: state.currentState,\n      }\n    default:\n      throw new Error(\"TS should protect from this\")\n  }\n}\n\nconst initialState: CanvasState = {\n  history: {\n    undoStack: [],\n    redoStack: [],\n  },\n  action: {\n    forceSendToStreamlit: false,\n    shouldReloadCanvas: false,\n  },\n  initialState: {},\n  currentState: {},\n}\n\ninterface CanvasStateContextProps {\n  canvasState: CanvasState\n  saveState: (state: Object) => void\n  undo: () => void\n  redo: () => void\n  forceStreamlitUpdate: () => void\n  canUndo: boolean\n  canRedo: boolean\n  resetState: (state: Object) => void\n}\n\nconst CanvasStateContext = createContext<CanvasStateContextProps>(\n  {} as CanvasStateContextProps\n)\n\nexport const CanvasStateProvider = ({\n  children,\n}: React.PropsWithChildren<{}>) => {\n  const [canvasState, dispatch] = useReducer(canvasStateReducer, initialState)\n\n  // Setup our callback functions\n  // We memoize with useCallback to prevent unnecessary re-renders\n  const saveState = useCallback(\n    (state) => dispatch({ type: \"save\", state: state }),\n    [dispatch]\n  )\n  const undo = useCallback(() => dispatch({ type: \"undo\" }), [dispatch])\n  const redo = useCallback(() => dispatch({ type: \"redo\" }), [dispatch])\n  const forceStreamlitUpdate = useCallback(\n    () => dispatch({ type: \"forceSendToStreamlit\" }),\n    [dispatch]\n  )\n  const resetState = useCallback(\n    (state) => dispatch({ type: \"reset\", state: state }),\n    [dispatch]\n  )\n\n  const canUndo = canvasState.history.undoStack.length !== 0\n  const canRedo = canvasState.history.redoStack.length !== 0\n\n  return (\n    <CanvasStateContext.Provider\n      value={{\n        canvasState,\n        saveState,\n        undo,\n        redo,\n        canUndo,\n        canRedo,\n        forceStreamlitUpdate,\n        resetState,\n      }}\n    >\n      {children}\n    </CanvasStateContext.Provider>\n  )\n}\n\n/**\n * Hook to get data out of context\n */\nexport const useCanvasState = () => {\n  return useContext(CanvasStateContext)\n}\n","import { fabric } from \"fabric\"\n\nexport interface ConfigureCanvasProps {\n  fillColor: string\n  strokeWidth: number\n  strokeColor: string\n  displayRadius: number\n  scaleFactors: number[] // Add scaleFactors here\n  canvasHeight: number // Add this line\n  canvasWidth: number // Add this line\n}\n\n/**\n * Base class for any fabric tool that configures and draws on canvas\n */\nabstract class FabricTool {\n  protected _canvas: fabric.Canvas\n  /**\n   * Pass Fabric canvas by reference so tools can configure it\n   */\n  constructor(canvas: fabric.Canvas) {\n    this._canvas = canvas\n  }\n\n  /**\n   * Configure canvas and return a callback to clean eventListeners\n   * @param args\n   */\n  abstract configureCanvas(args: ConfigureCanvasProps): () => void\n}\n\nexport default FabricTool\n","//SingleArrowHeadTool\nimport { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass SingleArrowHeadTool extends FabricTool {\n  isMouseDown: boolean = false\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentLine: fabric.Line = new fabric.Line()\n  startCircle: fabric.Circle = new fabric.Circle()\n  singlearrow: fabric.Group = new fabric.Group()\n  //startTriangle: fabric.Triangle = new fabric.Triangle()\n  endTriangle: fabric.Triangle = new fabric.Triangle()\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    var pointer = canvas.getPointer(o.e)\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\n    this.currentLine = new fabric.Line(points, {\n      strokeWidth: this.strokeWidth,\n      fill: this.strokeColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n\n    if (_clicked === 0) {\n      //canvas.add(this.currentLine)\n      canvas.add(this.singlearrow)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    var pointer = canvas.getPointer(o.e)\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y }) //takes the first point's coordinates from mouse down event\n    //this.currentLine.setCoords()\n\n    ////// Remove the previous group if it exists\n    if (this.singlearrow) {\n      canvas.remove(this.singlearrow)\n    }\n\n    // Initialize variables\n    let yy2: any = 0 // Initialization\n    let yy1: any = 0 // Initialization\n    let xx2: any = 0 // Initialization\n    let xx1: any = 0 // Initialization\n\n    yy2 = this.currentLine.y2\n    yy1 = this.currentLine.y1\n    xx2 = this.currentLine.x2\n    xx1 = this.currentLine.x1\n\n    var angle = Math.atan2(\n      // this.currentLine?.y2 - this.currentLine?.y1,\n      // this.currentLine?.x2 - this.currentLine?.x1\n      yy2 - yy1,\n      xx2 - xx1\n    )\n\n    // Create a triangle at the end of the line\n    this.endTriangle = new fabric.Triangle({\n      left: pointer.x,\n      top: pointer.y,\n      originX: \"center\",\n      originY: \"center\",\n      strokeWidth: this.strokeWidth,\n      stroke: this.strokeColor,\n      fill: this.strokeColor,\n      selectable: false,\n      evented: false,\n      width: this.strokeWidth * 5,\n      height: this.strokeWidth * 5,\n      angle: angle * (180 / Math.PI) + 90, // Convert the angle to degrees and add 90 to align with the line\n    })\n\n    this.singlearrow = new fabric.Group(\n      [\n        this.currentLine, //this.startTriangle,\n        this.endTriangle,\n      ],\n      {\n        selectable: false,\n        evented: false,\n      }\n    )\n\n    canvas.add(this.singlearrow)\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n    let canvas = this._canvas\n    var updatedgroup = this.singlearrow\n    canvas.remove(this.singlearrow)\n    canvas.add(updatedgroup)\n    canvas.renderAll()\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n}\n\nexport default SingleArrowHeadTool\n","//SingleArrowHeadTool\nimport { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass SingleArrowHeadTool extends FabricTool {\n  isMouseDown: boolean = false\n  strokeWidth: number = 10\n  // yy2: number = 0\n  // yy1: number = 0\n  // xx2: number = 0\n  // xx1: number = 0\n  strokeColor: string = \"#ffffff\"\n  currentLine: fabric.Line = new fabric.Line()\n  startCircle: fabric.Circle = new fabric.Circle()\n  doublearrow: fabric.Group = new fabric.Group()\n  startTriangle: fabric.Triangle = new fabric.Triangle()\n  endTriangle: fabric.Triangle = new fabric.Triangle()\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    var pointer = canvas.getPointer(o.e)\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\n    this.currentLine = new fabric.Line(points, {\n      strokeWidth: this.strokeWidth,\n      fill: this.strokeColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n\n    if (_clicked === 0) {\n      //canvas.add(this.currentLine)\n      canvas.add(this.doublearrow)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    var pointer = canvas.getPointer(o.e)\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y }) //takes the first point's coordinates from mouse down event\n    this.currentLine.setCoords()\n\n    ////// Remove the previous group if it exists\n    if (this.doublearrow) {\n      canvas.remove(this.doublearrow)\n    }\n\n    // Initialize variables\n    let yy2: any = 0 // Initialization\n    let yy1: any = 0 // Initialization\n    let xx2: any = 0 // Initialization\n    let xx1: any = 0 // Initialization\n\n    yy2 = this.currentLine.y2\n    yy1 = this.currentLine.y1\n    xx2 = this.currentLine.x2\n    xx1 = this.currentLine.x1\n\n    var angle = Math.atan2(yy2 - yy1, xx2 - xx1)\n\n    // Create a triangle at the end of the line\n    this.endTriangle = new fabric.Triangle({\n      left: pointer.x,\n      top: pointer.y,\n      originX: \"center\",\n      originY: \"center\",\n      strokeWidth: this.strokeWidth,\n      stroke: this.strokeColor,\n      fill: this.strokeColor,\n      selectable: false,\n      evented: false,\n      width: this.strokeWidth * 5,\n      height: this.strokeWidth * 5,\n      angle: angle * (180 / Math.PI) + 90, // Convert the angle to degrees and add 90 to align with the line\n    })\n\n    // Create a triangle at the start of the line\n    this.startTriangle = new fabric.Triangle({\n      left: this.currentLine.x1, //+ this.currentLine.left,\n      top: this.currentLine.y1, //+ this.currentLine.top,\n      originX: \"center\",\n      originY: \"center\",\n      strokeWidth: this.strokeWidth,\n      stroke: this.strokeColor,\n      fill: this.strokeColor,\n      selectable: false,\n      evented: false,\n      width: this.strokeWidth * 5,\n      height: this.strokeWidth * 5,\n      angle: angle * (180 / Math.PI) - 90, // Convert the angle to degrees and subtract 90 to align with the line\n    })\n\n    // Create a group and add the line and the triangles to it\n    this.doublearrow = new fabric.Group(\n      [this.currentLine, this.startTriangle, this.endTriangle],\n      {\n        selectable: false,\n        evented: false,\n      }\n    )\n\n    canvas.add(this.doublearrow)\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n    let canvas = this._canvas\n    // if (this.currentLine.width === 0 && this.currentLine.height === 0) {\n    //   canvas.remove(this.currentLine)\n    // }\n    //canvas.remove(this.currentLine)\n    var updatedgroup = this.doublearrow\n    canvas.remove(this.doublearrow)\n    canvas.add(updatedgroup)\n    canvas.renderAll()\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n}\n\nexport default SingleArrowHeadTool\n","// this file was delated to remove the circle drawing tool\nimport { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass CircleTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentCircle: fabric.Circle = new fabric.Circle()\n  currentStartX: number = 0\n  currentStartY: number = 0\n  _minRadius: number = 10\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n    this._minRadius = strokeWidth\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    let pointer = canvas.getPointer(o.e)\n    this.currentStartX = pointer.x\n    this.currentStartY = pointer.y\n    this.currentCircle = new fabric.Circle({\n      left: this.currentStartX,\n      top: this.currentStartY,\n      originX: \"left\",\n      originY: \"center\",\n      strokeWidth: this.strokeWidth,\n      stroke: this.strokeColor,\n      fill: this.fillColor,\n      selectable: false,\n      evented: false,\n      radius: this._minRadius,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentCircle)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    let pointer = canvas.getPointer(o.e)\n    let _radius =\n      this.linearDistance(\n        { x: this.currentStartX, y: this.currentStartY },\n        { x: pointer.x, y: pointer.y }\n      ) / 2\n    this.currentCircle.set({\n      radius: Math.max(_radius, this._minRadius),\n      angle:\n        (Math.atan2(\n          pointer.y - this.currentStartY,\n          pointer.x - this.currentStartX\n        ) *\n          180) /\n        Math.PI,\n    })\n    this.currentCircle.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n\n  /**\n   * Calculate the distance of two x,y points\n   *\n   * @param point1 an object with x,y attributes representing the start point\n   * @param point2 an object with x,y attributes representing the end point\n   *\n   * @returns {number}\n   */\n  linearDistance = (point1: any, point2: any) => {\n    let xs = point2.x - point1.x\n    let ys = point2.y - point1.y\n    return Math.sqrt(xs * xs + ys * ys)\n  }\n}\n\nexport default CircleTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass CoordinateTool extends FabricTool {\n  isMouseDown: boolean = false\n  strokeColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  horizontalLine: fabric.Line | null = null\n  verticalLine: fabric.Line | null = null\n  coordinateCircle: fabric.Circle | null = null\n  //coordinatesText: fabric.Text | null = null\n  coordinatesTextX: fabric.Text | null = null\n  coordinatesTextY: fabric.Text | null = null\n  tempHorizontalLine: fabric.Line | null = null\n  tempVerticalLine: fabric.Line | null = null\n  tempCoordinateCircle: fabric.Circle | null = null\n  tempCoordinatesText: fabric.Text | null = null\n  coordinates_group: fabric.Group = new fabric.Group()\n  tempCoordinates_group: fabric.Group = new fabric.Group()\n  scaleFactors: number[] = [1, 1, 1, 1] // Define scaleFactors as an array\n  canvasWidth: number = 1 // Define canvasHeight as a number\n  canvasHeight: number = 1\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    scaleFactors,\n    canvasHeight,\n    canvasWidth, // Ensure canvasHeight is destructured\n  }: ConfigureCanvasProps): () => void {\n    this.scaleFactors = scaleFactors // Assign scaleFactors to this.scaleFactors\n    this.canvasHeight = canvasHeight // Assign canvasHeight to this.canvasHeight\n    this.canvasWidth = canvasWidth\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", () => this.onMouseOut())\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n      this.clearTemporaryObjects()\n    }\n  }\n\n  onMouseDown(o: any) {\n    if (o.e.button === 0) {\n      this.isMouseDown = true\n      let canvas = this._canvas\n      let pointer = canvas.getPointer(o.e)\n      //this.updateLinesAndCircle(pointer.x, pointer.y)\n      this.drawLinesAndCoordinates(pointer.x, pointer.y)\n    }\n  }\n\n  onMouseMove(o: any) {\n    let canvas = this._canvas\n    let pointer = canvas.getPointer(o.e)\n    if (!this.isMouseDown) {\n      this.drawTemporaryLinesAndCoordinates(pointer.x, pointer.y)\n    }\n  }\n\n  onMouseUp(o: any) {\n    if (o.e.button === 0) {\n      this.isMouseDown = false\n      //let canvas = this._canvas\n      //let pointer = canvas.getPointer(o.e)\n      this.clearTemporaryObjects()\n      //this.drawLinesAndCoordinates(pointer.x, pointer.y)\n    }\n  }\n\n  onMouseOut() {\n    this.clearTemporaryObjects()\n  }\n\n  drawLinesAndCoordinates(x: number, y: number) {\n    let canvas = this._canvas\n    let strokeWidth = this.strokeWidth\n    let strokeColor = \"rgba(99, 99, 156, .75)\"\n    let canvasHeight = this.canvasHeight\n    let canvasWidth = this.canvasWidth\n\n    this.horizontalLine = new fabric.Line([0.12 * canvasWidth, y, x, y], {\n      stroke: strokeColor,\n      strokeWidth: strokeWidth,\n      selectable: false,\n      evented: false,\n      strokeDashArray: [10, 5],\n    })\n\n    this.verticalLine = new fabric.Line([x, y, x, 0.9 * canvasHeight], {\n      stroke: strokeColor,\n      strokeWidth: strokeWidth,\n      selectable: false,\n      evented: false,\n      strokeDashArray: [10, 5],\n    })\n\n    this.coordinateCircle = new fabric.Circle({\n      left: x,\n      top: y,\n      radius: 5,\n      fill: strokeColor,\n      selectable: false,\n      evented: false,\n      originX: \"center\",\n      originY: \"center\",\n    })\n\n    let xx =\n      ((this.scaleFactors[1] - this.scaleFactors[0]) *\n        (x - this.scaleFactors[2] * canvasWidth)) /\n      (this.scaleFactors[3] * canvasWidth)\n    let yy =\n      this.scaleFactors[1] -\n      ((this.scaleFactors[1] - this.scaleFactors[0]) *\n        (y - this.scaleFactors[2] * canvasHeight)) /\n        (this.scaleFactors[3] * canvasHeight)\n\n    this.coordinatesTextX = new fabric.Text(\n      `${xx.toFixed(0)}`,\n\n      {\n        left: x + 0.01 * canvasWidth, //x + 10,\n        top: 0.85 * canvasHeight, //y + 10,\n        fill: strokeColor,\n        fontSize: 14,\n        selectable: false,\n        evented: false,\n      }\n    )\n\n    this.coordinatesTextY = new fabric.Text(\n      `${yy.toFixed(0)}`,\n\n      {\n        left: 0.13 * canvasWidth, //x + 10,\n        top: y - 0.035 * canvasHeight, //y + 10,\n        fill: strokeColor,\n        fontSize: 14,\n        selectable: false,\n        evented: false,\n      }\n    )\n\n    this.coordinates_group = new fabric.Group(\n      [\n        this.horizontalLine,\n        this.verticalLine,\n        this.coordinateCircle,\n        this.coordinatesTextX,\n        this.coordinatesTextY,\n      ],\n      {\n        selectable: false,\n        evented: false,\n      }\n    )\n\n    canvas.add(this.coordinates_group)\n    canvas.renderAll()\n  }\n\n  drawTemporaryLinesAndCoordinates(x: number, y: number) {\n    let canvas = this._canvas\n    let strokeWidth = this.strokeWidth\n    let strokeColor = \"rgba(51, 0, 20, 0.5)\"\n    let canvasHeight = this.canvasHeight\n    let canvasWidth = this.canvasWidth\n    this.clearTemporaryObjects()\n\n    this.tempHorizontalLine = new fabric.Line([0.12 * canvasWidth, y, x, y], {\n      //0 is the default value for the x1 coordinate\n      stroke: strokeColor,\n      strokeWidth: strokeWidth,\n      selectable: false,\n      evented: false,\n      strokeDashArray: [10, 5],\n    })\n\n    this.tempVerticalLine = new fabric.Line([x, y, x, 0.9 * canvasHeight], {\n      stroke: strokeColor,\n      strokeWidth: strokeWidth,\n      selectable: false,\n      evented: false,\n      strokeDashArray: [10, 5],\n    })\n\n    this.tempCoordinateCircle = new fabric.Circle({\n      left: x,\n      top: y,\n      radius: 5,\n      fill: strokeColor,\n      selectable: false,\n      evented: false,\n      originX: \"center\",\n      originY: \"center\",\n    })\n\n    let xx =\n      ((this.scaleFactors[1] - this.scaleFactors[0]) *\n        (x - this.scaleFactors[2] * canvasWidth)) /\n      (this.scaleFactors[3] * canvasWidth)\n    let yy =\n      this.scaleFactors[1] -\n      ((this.scaleFactors[1] - this.scaleFactors[0]) *\n        (y - this.scaleFactors[2] * canvasHeight)) /\n        (this.scaleFactors[3] * canvasHeight)\n    this.tempCoordinatesText = new fabric.Text(\n      `(${xx.toFixed(0)}, ${yy.toFixed(0)})`,\n      //`(${x.toFixed(0)}, ${y.toFixed(0)})`,\n      {\n        left: x + 10,\n        top: y + 10,\n        fill: strokeColor,\n        fontSize: 14,\n        selectable: false,\n        evented: false,\n      }\n    )\n\n    this.tempCoordinates_group = new fabric.Group(\n      [\n        this.tempHorizontalLine,\n        this.tempVerticalLine,\n        this.tempCoordinateCircle,\n        this.tempCoordinatesText,\n      ],\n      {\n        selectable: false,\n        evented: false,\n      }\n    )\n\n    canvas.add(this.tempCoordinates_group)\n    canvas.renderAll()\n  }\n\n  clearTemporaryObjects() {\n    let canvas = this._canvas\n    if (this.tempCoordinates_group) canvas.remove(this.tempCoordinates_group)\n    //this.tempCoordinates_group= null\n  }\n}\n\nexport default CoordinateTool\n","import FabricTool from \"./fabrictool\"\nimport SingleArrowHeadTool from \"./singlearrowhead\"\nimport DoubleArrowHeadTool from \"./doublearrowhead\"\nimport CircleTool from \"./circle\"\nimport CoordinateTool from \"./coordinate\"\nimport CurveTool from \"./curve\"\nimport FreedrawTool from \"./freedraw\"\nimport LineTool from \"./line\"\nimport PointTool from \"./point\"\nimport PolygonTool from \"./polygon\"\nimport RectTool from \"./rect\"\nimport TextTool from \"./text\"\nimport TransformTool from \"./transform\"\n\n// TODO: Should make TS happy on the Map of selectedTool --> FabricTool\nconst tools: any = {\n  circle: CircleTool,\n  curve: CurveTool,\n  coordinate: CoordinateTool,\n  text: TextTool,\n  freedraw: FreedrawTool,\n  line: LineTool,\n  polygon: PolygonTool,\n  rect: RectTool,\n  singlearrowhead: SingleArrowHeadTool,\n  doublearrowhead: DoubleArrowHeadTool,\n  transform: TransformTool,\n  point: PointTool,\n}\n\nexport { tools, FabricTool }\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\nimport * as d3 from \"d3\"\n\nclass CurveTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff00\" //\"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  startCircle: fabric.Circle = new fabric.Circle()\n  curvePath: fabric.Path = new fabric.Path()\n  //tempCurvePath: fabric.Path = new fabric.Path()\n  controlPoints: number[][] = []\n  points: number[][] = []\n  //currentLine: fabric.Line = new fabric.Line()\n  currentLine: fabric.Path = new fabric.Path()\n  currentPath: fabric.Path = new fabric.Path()\n  _pathString: string = \"M \"\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    //this._canvas.on(\"mouse:dblclick\", (e: any) => this.onMouseDoubleClick(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n      //this._canvas.off(\"mouse:dblclick\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    let _start = false\n    if (this._pathString === \"M \") {\n      _start = true\n      this.controlPoints = []\n    }\n\n    this.isMouseDown = true\n    var pointer = canvas.getPointer(o.e)\n\n    //var points = [pointer.x, pointer.y, pointer.x, pointer.y]\n    this.points.push([pointer.x, pointer.y])\n    var linePath = this.generateCurvePathData(this.points)\n    canvas.remove(this.currentLine)\n    this.currentLine = new fabric.Path(linePath, {\n      strokeWidth: this.strokeWidth,\n      fill: \"\", //this.fillColor,\n      stroke: this.strokeColor,\n      // originX: \"center\",\n      // originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentLine)\n    }\n\n    if (_start && _clicked === 0) {\n      // Initialize pathString\n      //this._pathString += `${pointer.x} ${pointer.y} `\n      this.controlPoints.push([pointer.x, pointer.y])\n      this._pathString = this.generateCurvePathData(this.controlPoints)\n      this.startCircle = new fabric.Circle({\n        left: pointer.x,\n        top: pointer.y,\n        originX: \"center\",\n        originY: \"center\",\n        strokeWidth: this.strokeWidth,\n        stroke: this.strokeColor,\n        fill: this.strokeColor,\n        selectable: false,\n        evented: false,\n        radius: this.strokeWidth,\n      })\n      canvas.add(this.startCircle)\n\n      _start = false\n    } else {\n      canvas.remove(this.currentPath)\n      if (_clicked === 0) {\n        //if left mouse clicked\n        // Update pathString\n        //this._pathString += `L ${pointer.x} ${pointer.y} `\n        this.controlPoints.push([pointer.x, pointer.y])\n        this._pathString = this.generateCurvePathData(this.controlPoints)\n      }\n      if (_clicked === 2) {\n        //if right mouse clicked, Close pathString\n        //this._pathString += \"z\"\n        this.controlPoints.push([pointer.x, pointer.y])\n        this._pathString = this.generateCurvePathData(this.controlPoints)\n        canvas.remove(this.startCircle)\n      }\n    }\n    //canvas.remove(this.currentPath)\n    this.currentPath = new fabric.Path(this._pathString, {\n      strokeWidth: this.strokeWidth,\n      fill: \"\", //this.fillColor,\n      stroke: this.strokeColor,\n      // originX: \"center\",\n      // originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (this.currentPath.width !== 0 && this.currentPath.height !== 0) {\n      canvas.add(this.currentPath)\n    }\n    if (_clicked === 2) {\n      this._pathString = \"M \"\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    var pointer = canvas.getPointer(o.e)\n    // this.currentLine.set({ x2: pointer.x, y2: pointer.y })\n    // this.currentLine.setCoords()\n    this.points.push([pointer.x, pointer.y])\n    var linePath = this.generateCurvePathData(this.points)\n    canvas.remove(this.currentLine)\n    if (this._pathString != \"M \") {\n      canvas.remove(this.currentPath)\n    }\n    this.currentLine = new fabric.Path(linePath, {\n      strokeWidth: this.strokeWidth,\n      fill: \"\", //this.fillColor,\n      stroke: this.strokeColor,\n      // originX: \"center\",\n      // originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    canvas.add(this.currentLine)\n    canvas.renderAll()\n    //canvas.remove(this.currentLine)\n    this.points.pop()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = true\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n\n  // onMouseDoubleClick(o: any) {\n  //   let canvas = this._canvas\n  //   // Double click adds two more points at the end, so we have to move back twice more...\n  //   for (let i = 0; i < 3; i++) {\n  //     let _last_pt_idx = this._pathString.lastIndexOf(\"L\")\n  //     if (_last_pt_idx === -1) {\n  //       this._pathString = \"M \"\n  //       canvas.remove(this.startCircle)\n  //     } else {\n  //       this._pathString = this._pathString.slice(0, _last_pt_idx)\n  //     }\n  //   }\n\n  //   canvas.remove(this.currentLine)\n  //   canvas.remove(this.currentPath)\n  //   this.currentPath = new fabric.Path(this._pathString, {\n  //     strokeWidth: this.strokeWidth,\n  //     fill: \"#ffffff00\", //this.fillColor,\n  //     stroke: this.strokeColor,\n  //     originX: \"center\",\n  //     originY: \"center\",\n  //     selectable: false,\n  //     evented: false,\n  //   })\n  //   canvas.add(this.currentPath)\n  // }\n\n  private generateCurvePathData(controlPoints: number[][]): string {\n    var lineGenerator = d3.line().curve(d3.curveCatmullRom.alpha(0.5))\n    //@ts-ignore\n    return lineGenerator(controlPoints)\n  }\n}\n\nexport default CurveTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass TextTool extends FabricTool {\n  // eslint-disable-next-line\n  configureCanvas({}: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    var pointer = canvas.getPointer(o.e)\n\n    if (_clicked === 0) {\n      const userInput = prompt(\"Enter text:\")\n      if (userInput) {\n        let text = new fabric.IText(userInput, {\n          left: pointer.x,\n          top: pointer.y,\n          selectable: false,\n          evented: false,\n        })\n        canvas.add(text)\n      }\n    }\n  }\n}\n\nexport default TextTool\n","import FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass FreedrawTool extends FabricTool {\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = true\n    this._canvas.freeDrawingBrush.width = strokeWidth\n    this._canvas.freeDrawingBrush.color = strokeColor\n    return () => {}\n  }\n}\n\nexport default FreedrawTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass LineTool extends FabricTool {\n  isMouseDown: boolean = false\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentLine: fabric.Line = new fabric.Line()\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    var pointer = canvas.getPointer(o.e)\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\n    this.currentLine = new fabric.Line(points, {\n      strokeWidth: this.strokeWidth,\n      fill: this.strokeColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentLine)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    var pointer = canvas.getPointer(o.e)\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y }) //takes the first point's coordinates from mouse:down event and then replaces the second coordinate by the new one; that is why the line updates and is dynamic before mouse:down/up again\n    this.currentLine.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n    let canvas = this._canvas\n    if (this.currentLine.width === 0 && this.currentLine.height === 0) {\n      canvas.remove(this.currentLine)\n    }\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n}\n\nexport default LineTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass PolygonTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  startCircle: fabric.Circle = new fabric.Circle()\n  currentLine: fabric.Line = new fabric.Line()\n  currentPath: fabric.Path = new fabric.Path()\n  _pathString: string = \"M \"\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    this._canvas.on(\"mouse:dblclick\", (e: any) => this.onMouseDoubleClick(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n      this._canvas.off(\"mouse:dblclick\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    let _start = false\n    if (this._pathString === \"M \") {\n      _start = true\n    }\n\n    this.isMouseDown = true\n    var pointer = canvas.getPointer(o.e)\n\n    var points = [pointer.x, pointer.y, pointer.x, pointer.y]\n    canvas.remove(this.currentLine)\n    this.currentLine = new fabric.Line(points, {\n      strokeWidth: this.strokeWidth,\n      fill: this.strokeColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentLine)\n    }\n\n    if (_start && _clicked === 0) {\n      // Initialize pathString\n      this._pathString += `${pointer.x} ${pointer.y} `\n      this.startCircle = new fabric.Circle({\n        left: pointer.x,\n        top: pointer.y,\n        originX: \"center\",\n        originY: \"center\",\n        strokeWidth: this.strokeWidth,\n        stroke: this.strokeColor,\n        fill: this.strokeColor,\n        selectable: false,\n        evented: false,\n        radius: this.strokeWidth,\n      })\n      canvas.add(this.startCircle)\n\n      _start = false\n    } else {\n      canvas.remove(this.currentPath)\n      if (_clicked === 0) {\n        //if left mouse clicked\n        // Update pathString\n        this._pathString += `L ${pointer.x} ${pointer.y} `\n      }\n      if (_clicked === 2) {\n        //if right mouse clicked, Close pathString\n        this._pathString += \"z\"\n        canvas.remove(this.startCircle)\n      }\n    }\n    this.currentPath = new fabric.Path(this._pathString, {\n      strokeWidth: this.strokeWidth,\n      fill: this.fillColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    if (this.currentPath.width !== 0 && this.currentPath.height !== 0) {\n      canvas.add(this.currentPath)\n    }\n    if (_clicked === 2) {\n      this._pathString = \"M \"\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    var pointer = canvas.getPointer(o.e)\n    this.currentLine.set({ x2: pointer.x, y2: pointer.y })\n    this.currentLine.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = true\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseDoubleClick(o: any) {\n    let canvas = this._canvas\n    // Double click adds two more points at the end, so we have to move back twice more...\n    //AE: It think it is useful for doing undo on the canvas because if we try to use the undo button itself, it keeps drawing lines upto the borders of the canvas which is ugly\n    for (let i = 0; i < 3; i++) {\n      let _last_pt_idx = this._pathString.lastIndexOf(\"L\")\n      if (_last_pt_idx === -1) {\n        this._pathString = \"M \"\n        canvas.remove(this.startCircle)\n      } else {\n        this._pathString = this._pathString.slice(0, _last_pt_idx)\n      }\n    }\n\n    canvas.remove(this.currentLine)\n    canvas.remove(this.currentPath)\n    this.currentPath = new fabric.Path(this._pathString, {\n      strokeWidth: this.strokeWidth,\n      fill: this.fillColor,\n      stroke: this.strokeColor,\n      originX: \"center\",\n      originY: \"center\",\n      selectable: false,\n      evented: false,\n    })\n    canvas.add(this.currentPath)\n  }\n}\nexport default PolygonTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass RectTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentRect: fabric.Rect = new fabric.Rect()\n  currentStartX: number = 0\n  currentStartY: number = 0\n  _minLength: number = 10\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n    this._minLength = strokeWidth\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    let pointer = canvas.getPointer(o.e)\n    this.currentStartX = pointer.x\n    this.currentStartY = pointer.y\n    this.currentRect = new fabric.Rect({\n      left: this.currentStartX,\n      top: this.currentStartY,\n      originX: \"left\",\n      originY: \"top\",\n      width: this._minLength,\n      height: this._minLength,\n      stroke: this.strokeColor,\n      strokeWidth: this.strokeWidth,\n      fill: this.fillColor,\n      transparentCorners: false,\n      selectable: false,\n      evented: false,\n      strokeUniform: true,\n      noScaleCache: false,\n      angle: 0,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentRect)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    let pointer = canvas.getPointer(o.e)\n    if (this.currentStartX > pointer.x) {\n      this.currentRect.set({ left: Math.abs(pointer.x) })\n    }\n    if (this.currentStartY > pointer.y) {\n      this.currentRect.set({ top: Math.abs(pointer.y) })\n    }\n    let _width = Math.abs(this.currentStartX - pointer.x)\n    let _height = Math.abs(this.currentStartY - pointer.y)\n    this.currentRect.set({\n      width: Math.max(_width, this._minLength * 2),\n      height: Math.max(_height, this._minLength * 2),\n    })\n    this.currentRect.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n}\n\nexport default RectTool\n","import FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass TransformTool extends FabricTool {\n  configureCanvas(args: ConfigureCanvasProps): () => void {\n    let canvas = this._canvas\n    canvas.isDrawingMode = false\n    canvas.selection = true\n    canvas.forEachObject((o) => (o.selectable = o.evented = true))\n\n    // instead of looking for target of double click,\n    // assume double click on object clears the selected object\n    const handleDoubleClick = () => {\n      canvas.remove(canvas.getActiveObject())\n    }\n\n    canvas.on(\"mouse:dblclick\", handleDoubleClick)\n    return () => {\n      canvas.off(\"mouse:dblclick\", handleDoubleClick)\n    }\n  }\n}\n\nexport default TransformTool\n","import { fabric } from \"fabric\"\nimport FabricTool, { ConfigureCanvasProps } from \"./fabrictool\"\n\nclass PointTool extends FabricTool {\n  isMouseDown: boolean = false\n  fillColor: string = \"#ffffff\"\n  strokeWidth: number = 10\n  strokeColor: string = \"#ffffff\"\n  currentCircle: fabric.Circle = new fabric.Circle()\n  currentStartX: number = 0\n  currentStartY: number = 0\n  displayRadius: number = 1\n\n  configureCanvas({\n    strokeWidth,\n    strokeColor,\n    fillColor,\n    displayRadius\n  }: ConfigureCanvasProps): () => void {\n    this._canvas.isDrawingMode = false\n    this._canvas.selection = false\n    this._canvas.forEachObject((o) => (o.selectable = o.evented = false))\n\n    this.strokeWidth = strokeWidth\n    this.strokeColor = strokeColor\n    this.fillColor = fillColor\n    this.displayRadius = displayRadius\n\n    this._canvas.on(\"mouse:down\", (e: any) => this.onMouseDown(e))\n    this._canvas.on(\"mouse:move\", (e: any) => this.onMouseMove(e))\n    this._canvas.on(\"mouse:up\", (e: any) => this.onMouseUp(e))\n    this._canvas.on(\"mouse:out\", (e: any) => this.onMouseOut(e))\n    return () => {\n      this._canvas.off(\"mouse:down\")\n      this._canvas.off(\"mouse:move\")\n      this._canvas.off(\"mouse:up\")\n      this._canvas.off(\"mouse:out\")\n    }\n  }\n\n  onMouseDown(o: any) {\n    let canvas = this._canvas\n    let _clicked = o.e[\"button\"]\n    this.isMouseDown = true\n    let pointer = canvas.getPointer(o.e)\n    this.currentStartX = pointer.x - (this.displayRadius + this.strokeWidth / 2.)\n    this.currentStartY = pointer.y //- (this._minRadius + this.strokeWidth)\n    this.currentCircle = new fabric.Circle({\n      left: this.currentStartX,\n      top: this.currentStartY,\n      originX: \"left\",\n      originY: \"center\",\n      strokeWidth: this.strokeWidth,\n      stroke: this.strokeColor,\n      fill: this.fillColor,\n      selectable: false,\n      evented: false,\n      radius: this.displayRadius,\n    })\n    if (_clicked === 0) {\n      canvas.add(this.currentCircle)\n    }\n  }\n\n  onMouseMove(o: any) {\n    if (!this.isMouseDown) return\n    let canvas = this._canvas\n    this.currentCircle.setCoords()\n    canvas.renderAll()\n  }\n\n  onMouseUp(o: any) {\n    this.isMouseDown = false\n  }\n\n  onMouseOut(o: any) {\n    this.isMouseDown = false\n  }\n\n}\n\nexport default PointTool\n","import React, { useEffect, useState } from \"react\"\nimport {\n  ComponentProps,\n  Streamlit,\n  withStreamlitConnection,\n} from \"streamlit-component-lib\"\nimport { fabric } from \"fabric\"\nimport { isEqual } from \"lodash\"\n\nimport CanvasToolbar from \"./components/CanvasToolbar\"\nimport UpdateStreamlit from \"./components/UpdateStreamlit\"\n\nimport { useCanvasState } from \"./DrawableCanvasState\"\nimport { tools, FabricTool } from \"./lib\"\n\nfunction getStreamlitBaseUrl(): string | null {\n  const params = new URLSearchParams(window.location.search)\n  const baseUrl = params.get(\"streamlitUrl\")\n  if (baseUrl == null) {\n    return null\n  }\n\n  try {\n    return new URL(baseUrl).origin\n  } catch {\n    return null\n  }\n}\n\n/**\n * Arguments Streamlit receives from the Python side\n */\nexport interface PythonArgs {\n  fillColor: string\n  strokeWidth: number\n  strokeColor: string\n  backgroundColor: string\n  backgroundImageURL: string\n  realtimeUpdateStreamlit: boolean\n  canvasWidth: number\n  canvasHeight: number\n  drawingMode: string\n  initialDrawing: Object\n  displayToolbar: boolean\n  displayRadius: number\n  scaleFactors: number[] // Add scaleFactors here\n}\n\n/**\n * Define logic for the canvas area\n */\nconst DrawableCanvas = ({ args }: ComponentProps) => {\n  const {\n    canvasWidth,\n    canvasHeight,\n    backgroundColor,\n    backgroundImageURL,\n    realtimeUpdateStreamlit,\n    drawingMode,\n    fillColor,\n    strokeWidth,\n    strokeColor,\n    displayRadius,\n    initialDrawing,\n    displayToolbar,\n    scaleFactors, // Destructure scaleFactors from args\n  }: PythonArgs = args\n\n  /**\n   * State initialization\n   */\n  const [canvas, setCanvas] = useState(new fabric.Canvas(\"\"))\n  canvas.stopContextMenu = true\n  canvas.fireRightClick = true\n\n  const [backgroundCanvas, setBackgroundCanvas] = useState(\n    new fabric.StaticCanvas(\"\")\n  )\n  const {\n    canvasState: {\n      action: { shouldReloadCanvas, forceSendToStreamlit },\n      currentState,\n      initialState,\n    },\n    saveState,\n    undo,\n    redo,\n    canUndo,\n    canRedo,\n    forceStreamlitUpdate,\n    resetState,\n  } = useCanvasState()\n\n  /**\n   * Initialize canvases on component mount\n   * NB: Remount component by changing its key instead of defining deps\n   */\n  useEffect(() => {\n    const c = new fabric.Canvas(\"canvas\", {\n      enableRetinaScaling: false,\n    })\n    const imgC = new fabric.StaticCanvas(\"backgroundimage-canvas\", {\n      enableRetinaScaling: false,\n    })\n    setCanvas(c)\n    setBackgroundCanvas(imgC)\n    Streamlit.setFrameHeight()\n  }, [])\n\n  /**\n   * Load user drawing into canvas\n   * Python-side is in charge of initializing drawing with background color if none provided\n   */\n  useEffect(() => {\n    if (!isEqual(initialState, initialDrawing)) {\n      canvas.loadFromJSON(initialDrawing, () => {\n        canvas.renderAll()\n        resetState(initialDrawing)\n      })\n    }\n  }, [canvas, initialDrawing, initialState, resetState])\n\n  /**\n   * Update background image\n   */\n  useEffect(() => {\n    if (backgroundImageURL) {\n      var bgImage = new Image()\n      bgImage.onload = function () {\n        backgroundCanvas.getContext().drawImage(bgImage, 0, 0) //0.5, 0.5\n      }\n      const baseUrl = getStreamlitBaseUrl() ?? \"\"\n      bgImage.src = baseUrl + backgroundImageURL\n    }\n  }, [\n    canvas,\n    backgroundCanvas,\n    canvasHeight,\n    canvasWidth,\n    backgroundColor,\n    backgroundImageURL,\n    saveState,\n  ])\n\n  /**\n   * If state changed from undo/redo/reset, update user-facing canvas\n   */\n  useEffect(() => {\n    if (shouldReloadCanvas) {\n      canvas.loadFromJSON(currentState, () => {})\n    }\n  }, [canvas, shouldReloadCanvas, currentState])\n\n  /**\n   * Update canvas with selected tool\n   * PS: add initialDrawing in dependency so user drawing update reinits tool\n   */\n  useEffect(() => {\n    // Update canvas events with selected tool\n    const selectedTool = new tools[drawingMode](canvas) as FabricTool\n    const cleanupToolEvents = selectedTool.configureCanvas({\n      fillColor: fillColor,\n      strokeWidth: strokeWidth,\n      strokeColor: strokeColor,\n      displayRadius: displayRadius,\n      scaleFactors: scaleFactors,\n      canvasHeight: canvasHeight,\n      canvasWidth: canvasWidth,\n    })\n\n    canvas.on(\"mouse:up\", (e: any) => {\n      saveState(canvas.toJSON())\n      if (e[\"button\"] === 3) {\n        forceStreamlitUpdate()\n      }\n    })\n\n    canvas.on(\"mouse:dblclick\", () => {\n      saveState(canvas.toJSON())\n    })\n\n    // Cleanup tool + send data to Streamlit events\n    return () => {\n      cleanupToolEvents()\n      canvas.off(\"mouse:up\")\n      canvas.off(\"mouse:dblclick\")\n    }\n  }, [\n    canvas,\n    strokeWidth,\n    strokeColor,\n    displayRadius,\n    fillColor,\n    drawingMode,\n    initialDrawing,\n    scaleFactors, // <-- Added dependency\n    canvasHeight,\n    canvasWidth,\n    saveState,\n    forceStreamlitUpdate,\n  ])\n\n  /**\n   * Render canvas w/ toolbar\n   */\n  return (\n    <div style={{ position: \"relative\" }}>\n      <div\n        style={{\n          position: \"absolute\",\n          top: 0,\n          left: 0,\n          zIndex: -10,\n          visibility: \"hidden\",\n        }}\n      >\n        <UpdateStreamlit\n          canvasHeight={canvasHeight}\n          canvasWidth={canvasWidth}\n          shouldSendToStreamlit={\n            realtimeUpdateStreamlit || forceSendToStreamlit\n          }\n          stateToSendToStreamlit={currentState}\n        />\n      </div>\n      <div\n        style={{\n          position: \"absolute\",\n          top: 0,\n          left: 0,\n          zIndex: 0,\n        }}\n      >\n        <canvas\n          id=\"backgroundimage-canvas\"\n          width={canvasWidth}\n          height={canvasHeight}\n        />\n      </div>\n      <div\n        style={{\n          position: \"absolute\",\n          top: 0,\n          left: 0,\n          zIndex: 10,\n        }}\n      >\n        <canvas\n          id=\"canvas\"\n          width={canvasWidth}\n          height={canvasHeight}\n          style={{ border: \"lightgrey 1px solid\" }}\n        />\n      </div>\n      {displayToolbar && (\n        <CanvasToolbar\n          topPosition={canvasHeight}\n          leftPosition={canvasWidth}\n          canUndo={canUndo}\n          canRedo={canRedo}\n          downloadCallback={forceStreamlitUpdate}\n          undoCallback={undo}\n          redoCallback={redo}\n          resetCallback={() => {\n            resetState(initialState)\n          }}\n        />\n      )}\n    </div>\n  )\n}\n\nexport default withStreamlitConnection(DrawableCanvas)\n","import React from \"react\"\nimport ReactDOM from \"react-dom\"\nimport DrawableCanvas from \"./DrawableCanvas\"\nimport { CanvasStateProvider } from \"./DrawableCanvasState\"\n\nimport \"./index.css\"\n\nReactDOM.render(\n  <React.StrictMode>\n    <CanvasStateProvider>\n      <DrawableCanvas />\n    </CanvasStateProvider>\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n)\n","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAwwAAAMMBnc7+MwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEFSURBVEiJ7dSxLkRBFMbx31BIlkQlHoCap5BQLAXvQafV6DyLRLYSdkWv0dBQ0NAKkUhkj2bEzc3udW9xE5E9yVfNd85/5pyZSRGhzZhqtfoE8DcAKaVOqwD0mkBSSnNNAAmBAboR8V4qtoguVrNWMI9n3Gad4SQqHlRk9dHJvmns4qWwXqUrbESEspSMfazhekyhN9zhc8z6KWarAKN0jm0sI+WkmdyuPTyV/JdFSBXgATujjl3aYQf7+CjkXhTaPRYw+DbVETZLkMM6Leo3hGxhmHNfsVBnBk0hx4XcozqARpA8/GG+bQcJ6+rFTUQ81jGmlJYi4p6fa9da/IPvegL4Lb4A0uc9nRaYXwcAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAhQAAAIUB4uz/wQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHUSURBVEiJtda9ahRRFAfw3xHFJCabFEkawcYiYKMWVmohBHwFOwsfQLCxthOENHZqKxZG8DHSxcJC0Qcw7AqSNSoGci3mznp3nP0K8cBlZs7X/5z//RopJeMGlrGL1Bi7WJ4Uf9pk2cQVPMDPrJvHVra9GRc8BBARS7iKU4X6cn5+wvf8vljbIuJr4XuEdyml/YGmoGIdX/xLxayji/U2iu5iJXfwa1zbY2QOOznXE4YpuoE93D5m8lr2cLMN4BWu4TF+4HDGxIEOeng90DaW5BkVj/fyd6dhP4u5hq6Tnxdz7GZpL1eLlNIhvmEtq7Yj4mHhsoWng5Ir23b+rGO6Zc62fdAtnFewUdjOqyaylo3sMxJgqIMsvcJ5X8XrKFlCvwHQmwRQdjArwH5K6fc0AKvHAFjVoGcUwCwUdbKPHNNrOpw0RVN10MVCRCz8T4A6oI/FiIiTBKh5XFN1EDnRkETEnGrnH2sOSoC60rbqoR8R8zg3bQe102oB0DYPAwB/l/VkgJTSgeo+KDtoA6h1fSN2Me1nUV3JOj7iOT5k/csi5jNe4D2uj+og8lE7rIx4hjt4hIMRRZRyX7UYLqWUjoYsI35VLuCt6tKZ5h7ewa22XH8AgjMTispa6ucAAAAASUVORK5CYII=\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEYSURBVEiJ7dS9SgNBFMXxX0y0NNpLqjQiKRRETON7aBMfwLfxDcRGC8HOTm21s7RIYZdniGiRO+6y5mNXVxD0wMBw58z532Fnh1+kFq5jNH8C0MFbjE7ZTUsVAEsz5rUBvqR/wB8CNLFeY+5aZH4ArjDCXsHYNv+vbWK1UNuNrMs8oGfyFGzmjDthvA9QUe1YG4U3aQvL2M4DpqkRHfZxU4C0o9aPxhpzcsDQ5I0ZFOpHGMfas+wtSvNxePIaxNpw0QngHIcR1M3Vu3jFcXhmqsw1vZCdJCmFny3a3CoBSBAm3TbKhlcBJEj6Vo9lN1UBwENF/yfAAVaqhhS0P614J7uCdY1bsh+kh1NsfLP7pBec4KmmvNl6B0BuQt0zCQ0xAAAAAElFTkSuQmCC\""],"sourceRoot":""}