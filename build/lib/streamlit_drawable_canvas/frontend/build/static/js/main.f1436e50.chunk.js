(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(t,e,s){t.exports={enabled:"CanvasToolbar_enabled__3qejl",disabled:"CanvasToolbar_disabled__375cH",invertx:"CanvasToolbar_invertx__BrmIZ"}},101:function(t,e,s){},102:function(t,e,s){"use strict";s.r(e);var o=s(1),i=s.n(o),n=s(25),r=s.n(n),a=s(5),c=s(0),h=s(3),l=s(10),u=s.n(l),d=s(27),f=s.n(d),v=s(14),k=s.n(v),b=s(28),m=s.n(b);const w=t=>{let{imgUrl:e,altText:s,invertX:o,size:n,enabled:r,clickCallback:a}=t;return i.a.createElement("img",{src:e,className:"\n    ".concat(r?u.a.enabled:u.a.disabled," ").concat(o?"":u.a.invertx,"\n    "),alt:s,title:s,height:"".concat(n,"px"),width:"".concat(n,"px"),onClick:a})};w.defaultProps={invertX:!1};var g=t=>{let{topPosition:e,leftPosition:s,canUndo:o,canRedo:n,downloadCallback:r,undoCallback:a,redoCallback:c,resetCallback:h}=t;const l=[{imgUrl:m.a,altText:"Send to Streamlit",invertX:!1,enabled:!0,clickCallback:r},{imgUrl:k.a,altText:"Undo",invertX:!0,enabled:o,clickCallback:o?a:()=>{}},{imgUrl:k.a,altText:"Redo",invertX:!1,enabled:n,clickCallback:n?c:()=>{}},{imgUrl:f.a,altText:"Reset canvas & history",invertX:!1,enabled:!0,clickCallback:h}];return i.a.createElement("div",{style:{position:"absolute",top:e+4,left:0,display:"flex",gap:4,zIndex:20}},l.map(t=>i.a.createElement(w,{key:t.altText,imgUrl:t.imgUrl,altText:t.altText,invertX:t.invertX,size:24,enabled:t.enabled,clickCallback:t.clickCallback})))};var C=t=>{const[e,s]=Object(o.useState)(new c.fabric.Canvas("")),n=((t,e)=>{const[s,i]=Object(o.useState)(t);return Object(o.useEffect)(()=>{const s=setTimeout(()=>{i(t)},e);return()=>{clearTimeout(s)}},[t,e]),s})(t.stateToSendToStreamlit,200);return Object(o.useEffect)(()=>{const t=new c.fabric.Canvas("canvas-to-streamlit",{enableRetinaScaling:!1});s(t)},[]),Object(o.useEffect)(()=>{n&&t.shouldSendToStreamlit&&e.loadFromJSON(n,()=>{(t=>{const e=t.getContext().canvas.toDataURL();a.a.setComponentValue({data:e,width:t.getWidth(),height:t.getHeight(),raw:t.toObject()})})(e)})},[e,t.shouldSendToStreamlit,n]),i.a.createElement("canvas",{id:"canvas-to-streamlit",width:t.canvasWidth,height:t.canvasHeight})};const p={shouldReloadCanvas:!1,forceSendToStreamlit:!1},S={shouldReloadCanvas:!0,forceSendToStreamlit:!1},M={shouldReloadCanvas:!1,forceSendToStreamlit:!0},_={shouldReloadCanvas:!0,forceSendToStreamlit:!0},A=(t,e)=>{switch(e.type){case"save":if(e.state){if(Object(h.isEmpty)(t.currentState))return{history:{undoStack:[],redoStack:[]},action:{...p},initialState:e.state,currentState:e.state};if(Object(h.isEqual)(e.state,t.currentState))return{history:{...t.history},action:{...p},initialState:t.initialState,currentState:t.currentState};{const s=t.history.undoStack.length>=100;return{history:{undoStack:[...t.history.undoStack.slice(s?1:0),t.currentState],redoStack:[]},action:{...p},initialState:null==t.initialState?t.currentState:t.initialState,currentState:e.state}}}throw new Error("No action state to save");case"undo":if(Object(h.isEmpty)(t.currentState)||Object(h.isEqual)(t.initialState,t.currentState))return{history:{...t.history},action:{...p},initialState:t.initialState,currentState:t.currentState};{const e=0===t.history.undoStack.length;return{history:{undoStack:t.history.undoStack.slice(0,-1),redoStack:[...t.history.redoStack,t.currentState]},action:{...S},initialState:t.initialState,currentState:e?t.currentState:t.history.undoStack[t.history.undoStack.length-1]}}case"redo":return t.history.redoStack.length>0?{history:{undoStack:[...t.history.undoStack,t.currentState],redoStack:t.history.redoStack.slice(0,-1)},action:{...S},initialState:t.initialState,currentState:t.history.redoStack[t.history.redoStack.length-1]}:{history:{...t.history},action:{...p},initialState:t.initialState,currentState:t.currentState};case"reset":if(!e.state)throw new Error("No action state to store in reset");return{history:{undoStack:[],redoStack:[]},action:{..._},initialState:e.state,currentState:e.state};case"forceSendToStreamlit":return{history:{...t.history},action:{...M},initialState:t.initialState,currentState:t.currentState};default:throw new Error("TS should protect from this")}},x={history:{undoStack:[],redoStack:[]},action:{forceSendToStreamlit:!1,shouldReloadCanvas:!1},initialState:{},currentState:{}},y=Object(o.createContext)({}),D=t=>{let{children:e}=t;const[s,n]=Object(o.useReducer)(A,x),r=Object(o.useCallback)(t=>n({type:"save",state:t}),[n]),a=Object(o.useCallback)(()=>n({type:"undo"}),[n]),c=Object(o.useCallback)(()=>n({type:"redo"}),[n]),h=Object(o.useCallback)(()=>n({type:"forceSendToStreamlit"}),[n]),l=Object(o.useCallback)(t=>n({type:"reset",state:t}),[n]),u=0!==s.history.undoStack.length,d=0!==s.history.redoStack.length;return i.a.createElement(y.Provider,{value:{canvasState:s,saveState:r,undo:a,redo:c,canUndo:u,canRedo:d,forceStreamlitUpdate:h,resetState:l}},e)};var L=class{constructor(t){this._canvas=void 0,this._canvas=t}};var W=class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.strokeWidth=10,this.strokeColor="#ffffff",this.currentLine=new c.fabric.Line,this.startCircle=new c.fabric.Circle,this.singlearrow=new c.fabric.Group,this.endTriangle=new c.fabric.Triangle}configureCanvas(t){let{strokeWidth:e,strokeColor:s}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out")}}onMouseDown(t){let e=this._canvas,s=t.e.button;this.isMouseDown=!0;var o=e.getPointer(t.e),i=[o.x,o.y,o.x,o.y];this.currentLine=new c.fabric.Line(i,{strokeWidth:this.strokeWidth,fill:this.strokeColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0===s&&e.add(this.singlearrow)}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas;var s=e.getPointer(t.e);this.currentLine.set({x2:s.x,y2:s.y}),this.singlearrow&&e.remove(this.singlearrow);let o=0,i=0,n=0,r=0;o=this.currentLine.y2,i=this.currentLine.y1,n=this.currentLine.x2,r=this.currentLine.x1;var a,h=Math.atan2(o-i,n-r);this.endTriangle=new c.fabric.Triangle({left:s.x,top:s.y,originX:"center",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.strokeColor,selectable:!1,evented:!1,width:5*this.strokeWidth,height:5*this.strokeWidth,angle:h*(180/Math.PI)+90}),this.singlearrow=new c.fabric.Group([this.currentLine,this.endTriangle],{selectable:!1,evented:!1}),this.singlearrow.toObject=(a=this.singlearrow.toObject,function(){return c.fabric.util.object.extend(a.call(this),{toolType:"SingleArrowHeadTool"})}),e.add(this.singlearrow),e.renderAll()}onMouseUp(t){this.isMouseDown=!1;let e=this._canvas;var s=this.singlearrow;e.remove(this.singlearrow),e.add(s),e.renderAll()}onMouseOut(t){this.isMouseDown=!1}};var O=class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.strokeWidth=10,this.strokeColor="#ffffff",this.currentLine=new c.fabric.Line,this.startCircle=new c.fabric.Circle,this.doublearrow=new c.fabric.Group,this.startTriangle=new c.fabric.Triangle,this.endTriangle=new c.fabric.Triangle}configureCanvas(t){let{strokeWidth:e,strokeColor:s}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out")}}onMouseDown(t){let e=this._canvas,s=t.e.button;this.isMouseDown=!0;var o=e.getPointer(t.e),i=[o.x,o.y,o.x,o.y];this.currentLine=new c.fabric.Line(i,{strokeWidth:this.strokeWidth,fill:this.strokeColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0===s&&e.add(this.doublearrow)}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas;var s=e.getPointer(t.e);this.currentLine.set({x2:s.x,y2:s.y}),this.currentLine.setCoords(),this.doublearrow&&e.remove(this.doublearrow);let o=0,i=0,n=0,r=0;o=this.currentLine.y2,i=this.currentLine.y1,n=this.currentLine.x2,r=this.currentLine.x1;var a=Math.atan2(o-i,n-r);this.endTriangle=new c.fabric.Triangle({left:s.x,top:s.y,originX:"center",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.strokeColor,selectable:!1,evented:!1,width:5*this.strokeWidth,height:5*this.strokeWidth,angle:a*(180/Math.PI)+90}),this.startTriangle=new c.fabric.Triangle({left:this.currentLine.x1,top:this.currentLine.y1,originX:"center",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.strokeColor,selectable:!1,evented:!1,width:5*this.strokeWidth,height:5*this.strokeWidth,angle:a*(180/Math.PI)-90}),this.doublearrow=new c.fabric.Group([this.currentLine,this.startTriangle,this.endTriangle],{selectable:!1,evented:!1}),e.add(this.doublearrow),e.renderAll()}onMouseUp(t){this.isMouseDown=!1;let e=this._canvas;var s=this.doublearrow;e.remove(this.doublearrow),e.add(s),e.renderAll()}onMouseOut(t){this.isMouseDown=!1}};var R=class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.fillColor="#ffffff",this.strokeWidth=10,this.strokeColor="#ffffff",this.currentCircle=new c.fabric.Circle,this.currentStartX=0,this.currentStartY=0,this._minRadius=10,this.linearDistance=((t,e)=>{let s=e.x-t.x,o=e.y-t.y;return Math.sqrt(s*s+o*o)})}configureCanvas(t){let{strokeWidth:e,strokeColor:s,fillColor:o}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this.fillColor=o,this._minRadius=e,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out")}}onMouseDown(t){let e=this._canvas,s=t.e.button;this.isMouseDown=!0;let o=e.getPointer(t.e);this.currentStartX=o.x,this.currentStartY=o.y,this.currentCircle=new c.fabric.Circle({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.fillColor,selectable:!1,evented:!1,radius:this._minRadius}),0===s&&e.add(this.currentCircle)}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas,s=e.getPointer(t.e),o=this.linearDistance({x:this.currentStartX,y:this.currentStartY},{x:s.x,y:s.y})/2;this.currentCircle.set({radius:Math.max(o,this._minRadius),angle:180*Math.atan2(s.y-this.currentStartY,s.x-this.currentStartX)/Math.PI}),this.currentCircle.setCoords(),e.renderAll()}onMouseUp(t){this.isMouseDown=!1}onMouseOut(t){this.isMouseDown=!1}};var T=class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.strokeColor="#ffffff",this.strokeWidth=10,this.horizontalLine=null,this.verticalLine=null,this.coordinateCircle=null,this.coordinatesTextX=null,this.coordinatesTextY=null,this.tempHorizontalLine=null,this.tempVerticalLine=null,this.tempCoordinateCircle=null,this.tempCoordinatesText=null,this.coordinates_group=new c.fabric.Group,this.tempCoordinates_group=new c.fabric.Group,this.scaleFactors=[1,1,1,1,1,1],this.canvasWidth=1,this.canvasHeight=1}configureCanvas(t){let{strokeWidth:e,strokeColor:s,scaleFactors:o,canvasHeight:i,canvasWidth:n}=t;return this.scaleFactors=o,this.canvasHeight=i,this.canvasWidth=n,this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",()=>this.onMouseOut()),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out"),this.clearTemporaryObjects()}}onMouseDown(t){if(0===t.e.button){this.isMouseDown=!0;let e=this._canvas.getPointer(t.e);this.drawLinesAndCoordinates(e.x,e.y)}}onMouseMove(t){let e=this._canvas.getPointer(t.e);this.isMouseDown||this.drawTemporaryLinesAndCoordinates(e.x,e.y)}onMouseUp(t){0===t.e.button&&(this.isMouseDown=!1,this.clearTemporaryObjects())}onMouseOut(){this.clearTemporaryObjects()}drawLinesAndCoordinates(t,e){let s=this._canvas,o=this.strokeWidth,i="rgba(99, 99, 156, .75)",n=this.canvasHeight,r=this.canvasWidth;this.horizontalLine=new c.fabric.Line([this.scaleFactors[3],e,t,e],{stroke:i,strokeWidth:o,selectable:!1,evented:!1,strokeDashArray:[10,5]}),this.verticalLine=new c.fabric.Line([t,e,t,.85*n],{stroke:i,strokeWidth:o,selectable:!1,evented:!1,strokeDashArray:[10,5]}),this.coordinateCircle=new c.fabric.Circle({left:t,top:e,radius:5,fill:i,selectable:!1,evented:!1,originX:"center",originY:"center"});let a=(t-this.scaleFactors[3])/(r-this.scaleFactors[3]-this.scaleFactors[5])*this.scaleFactors[0],h=this.scaleFactors[1]-(e-this.scaleFactors[4])/(n-this.scaleFactors[4]-this.scaleFactors[2])*this.scaleFactors[1];this.coordinatesTextX=new c.fabric.Text("".concat(a.toFixed(0)),{left:t+.01*r,top:.8*n,fill:i,fontSize:14,selectable:!1,evented:!1}),this.coordinatesTextY=new c.fabric.Text("".concat(h.toFixed(0)),{left:.13*r,top:e-.035*n,fill:i,fontSize:14,selectable:!1,evented:!1}),this.coordinates_group=new c.fabric.Group([this.horizontalLine,this.verticalLine,this.coordinateCircle,this.coordinatesTextX,this.coordinatesTextY],{selectable:!1,evented:!1}),s.add(this.coordinates_group),s.renderAll()}drawTemporaryLinesAndCoordinates(t,e){let s=this._canvas,o=this.strokeWidth,i="rgba(51, 0, 20, 0.5)",n=this.canvasHeight,r=this.canvasWidth;this.clearTemporaryObjects(),this.tempHorizontalLine=new c.fabric.Line([.12*r,e,t,e],{stroke:i,strokeWidth:o,selectable:!1,evented:!1,strokeDashArray:[10,5]}),this.tempVerticalLine=new c.fabric.Line([t,e,t,.85*n],{stroke:i,strokeWidth:o,selectable:!1,evented:!1,strokeDashArray:[10,5]}),this.tempCoordinateCircle=new c.fabric.Circle({left:t,top:e,radius:5,fill:i,selectable:!1,evented:!1,originX:"center",originY:"center"});let a=(t-this.scaleFactors[3])/(r-this.scaleFactors[3]-this.scaleFactors[5])*this.scaleFactors[0],h=this.scaleFactors[1]-(e-this.scaleFactors[4])/(n-this.scaleFactors[4]-this.scaleFactors[2])*this.scaleFactors[1];this.tempCoordinatesText=new c.fabric.Text("(".concat(a.toFixed(0),", ").concat(h.toFixed(0),")"),{left:t+10,top:e+10,fill:i,fontSize:14,selectable:!1,evented:!1}),this.tempCoordinates_group=new c.fabric.Group([this.tempHorizontalLine,this.tempVerticalLine,this.tempCoordinateCircle,this.tempCoordinatesText],{selectable:!1,evented:!1}),s.add(this.tempCoordinates_group),s.renderAll()}clearTemporaryObjects(){let t=this._canvas;this.tempCoordinates_group&&t.remove(this.tempCoordinates_group)}},j=s(15);const P={circle:R,curve:class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.fillColor="#ffffff00",this.strokeWidth=10,this.strokeColor="#ffffff",this.startCircle=new c.fabric.Circle,this.curvePath=new c.fabric.Path,this.tempCurvePath=new c.fabric.Path,this.controlPoints=[],this.points=[],this.tempCurve=new c.fabric.Path,this.finalCurve=new c.fabric.Path,this._pathString="M "}configureCanvas(t){let{strokeWidth:e,strokeColor:s,fillColor:o}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this.fillColor=o,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out")}}onMouseDown(t){let e=this._canvas,s=t.e.button,o=!1;"M "===this._pathString&&(o=!0),this.isMouseDown=!0;var i=e.getPointer(t.e);this.points.push([i.x,i.y]),o&&0===s?(this.controlPoints.push([i.x,i.y]),this._pathString=this.generateCurvePathData(this.controlPoints),this.startCircle=new c.fabric.Circle({left:i.x,top:i.y,originX:"center",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.strokeColor,selectable:!1,evented:!1,radius:this.strokeWidth}),e.add(this.startCircle),o=!1):(0===s&&(this.controlPoints.push([i.x,i.y]),this._pathString=this.generateCurvePathData(this.controlPoints)),2===s&&(this.controlPoints.push([i.x,i.y]),this._pathString=this.generateCurvePathData(this.controlPoints),e.remove(this.startCircle))),2===s&&(e.remove(this.tempCurve),this.finalCurve=new c.fabric.Path(this._pathString,{strokeWidth:this.strokeWidth,fill:"",stroke:this.strokeColor,selectable:!1,evented:!1}),0!==this.finalCurve.width&&0!==this.finalCurve.height&&e.add(this.finalCurve),this._pathString="M ",this.controlPoints=[],this.points=[])}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas;var s=e.getPointer(t.e);this.points.push([s.x,s.y]);var o=this.generateCurvePathData(this.points);e.remove(this.tempCurve),this.tempCurve=new c.fabric.Path(o,{strokeWidth:this.strokeWidth,fill:"",stroke:this.strokeColor,selectable:!1,evented:!1}),e.add(this.tempCurve),this.points.pop()}onMouseUp(t){this.isMouseDown=!0}onMouseOut(t){this.isMouseDown=!1}generateCurvePathData(t){return j.b().curve(j.a.alpha(.5))(t)}},coordinate:T,text:class extends L{configureCanvas(t){let{}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this._canvas.on("mouse:down",t=>this.onMouseDown(t)),()=>{this._canvas.off("mouse:down")}}onMouseDown(t){let e=this._canvas,s=t.e.button;var o=e.getPointer(t.e);if(0===s){const t=prompt("Enter text:");if(t){let s=new c.fabric.IText(t,{left:o.x,top:o.y,fontSize:25,selectable:!1,evented:!1});e.add(s)}}}},freedraw:class extends L{configureCanvas(t){let{strokeWidth:e,strokeColor:s}=t;return this._canvas.isDrawingMode=!0,this._canvas.freeDrawingBrush.width=e,this._canvas.freeDrawingBrush.color=s,()=>{}}},line:class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.strokeWidth=10,this.strokeColor="#ffffff",this.currentLine=new c.fabric.Line}configureCanvas(t){let{strokeWidth:e,strokeColor:s}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out")}}onMouseDown(t){let e=this._canvas,s=t.e.button;this.isMouseDown=!0;var o=e.getPointer(t.e),i=[o.x,o.y,o.x,o.y];this.currentLine=new c.fabric.Line(i,{strokeWidth:this.strokeWidth,fill:this.strokeColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0===s&&e.add(this.currentLine)}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas;var s=e.getPointer(t.e);this.currentLine.set({x2:s.x,y2:s.y}),this.currentLine.setCoords(),e.renderAll()}onMouseUp(t){this.isMouseDown=!1;let e=this._canvas;0===this.currentLine.width&&0===this.currentLine.height&&e.remove(this.currentLine)}onMouseOut(t){this.isMouseDown=!1}},polygon:class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.fillColor="#ffffff",this.strokeWidth=10,this.strokeColor="#ffffff",this.startCircle=new c.fabric.Circle,this.currentLine=new c.fabric.Line,this.currentPath=new c.fabric.Path,this._pathString="M "}configureCanvas(t){let{strokeWidth:e,strokeColor:s,fillColor:o}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this.fillColor=o,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),this._canvas.on("mouse:dblclick",t=>this.onMouseDoubleClick(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out"),this._canvas.off("mouse:dblclick")}}onMouseDown(t){let e=this._canvas,s=t.e.button,o=!1;"M "===this._pathString&&(o=!0),this.isMouseDown=!0;var i=e.getPointer(t.e),n=[i.x,i.y,i.x,i.y];e.remove(this.currentLine),this.currentLine=new c.fabric.Line(n,{strokeWidth:this.strokeWidth,fill:this.strokeColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0===s&&e.add(this.currentLine),o&&0===s?(this._pathString+="".concat(i.x," ").concat(i.y," "),this.startCircle=new c.fabric.Circle({left:i.x,top:i.y,originX:"center",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.strokeColor,selectable:!1,evented:!1,radius:this.strokeWidth}),e.add(this.startCircle),o=!1):(e.remove(this.currentPath),0===s&&(this._pathString+="L ".concat(i.x," ").concat(i.y," ")),2===s&&(this._pathString+="z",e.remove(this.startCircle))),this.currentPath=new c.fabric.Path(this._pathString,{strokeWidth:this.strokeWidth,fill:this.fillColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),0!==this.currentPath.width&&0!==this.currentPath.height&&e.add(this.currentPath),2===s&&(this._pathString="M ")}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas;var s=e.getPointer(t.e);this.currentLine.set({x2:s.x,y2:s.y}),this.currentLine.setCoords(),e.renderAll()}onMouseUp(t){this.isMouseDown=!0}onMouseOut(t){this.isMouseDown=!1}onMouseDoubleClick(t){let e=this._canvas;for(let s=0;s<3;s++){let t=this._pathString.lastIndexOf("L");-1===t?(this._pathString="M ",e.remove(this.startCircle)):this._pathString=this._pathString.slice(0,t)}e.remove(this.currentLine),e.remove(this.currentPath),this.currentPath=new c.fabric.Path(this._pathString,{strokeWidth:this.strokeWidth,fill:this.fillColor,stroke:this.strokeColor,originX:"center",originY:"center",selectable:!1,evented:!1}),e.add(this.currentPath)}},rect:class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.fillColor="#ffffff",this.strokeWidth=10,this.strokeColor="#ffffff",this.currentRect=new c.fabric.Rect,this.currentStartX=0,this.currentStartY=0,this._minLength=10}configureCanvas(t){let{strokeWidth:e,strokeColor:s,fillColor:o}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this.fillColor=o,this._minLength=e,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out")}}onMouseDown(t){let e=this._canvas,s=t.e.button;this.isMouseDown=!0;let o=e.getPointer(t.e);this.currentStartX=o.x,this.currentStartY=o.y,this.currentRect=new c.fabric.Rect({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"top",width:this._minLength,height:this._minLength,stroke:this.strokeColor,strokeWidth:this.strokeWidth,fill:this.fillColor,transparentCorners:!1,selectable:!1,evented:!1,strokeUniform:!0,noScaleCache:!1,angle:0}),0===s&&e.add(this.currentRect)}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas,s=e.getPointer(t.e);this.currentStartX>s.x&&this.currentRect.set({left:Math.abs(s.x)}),this.currentStartY>s.y&&this.currentRect.set({top:Math.abs(s.y)});let o=Math.abs(this.currentStartX-s.x),i=Math.abs(this.currentStartY-s.y);this.currentRect.set({width:Math.max(o,2*this._minLength),height:Math.max(i,2*this._minLength)}),this.currentRect.setCoords(),e.renderAll()}onMouseUp(t){this.isMouseDown=!1}onMouseOut(t){this.isMouseDown=!1}},singlearrowhead:W,doublearrowhead:O,transform:class extends L{configureCanvas(t){let e=this._canvas;e.isDrawingMode=!1,e.selection=!0,e.forEachObject(t=>t.selectable=t.evented=!0);const s=()=>{e.remove(e.getActiveObject())};return e.on("mouse:dblclick",s),()=>{e.off("mouse:dblclick",s)}}},point:class extends L{constructor(){super(...arguments),this.isMouseDown=!1,this.fillColor="#ffffff",this.strokeWidth=10,this.strokeColor="#ffffff",this.currentCircle=new c.fabric.Circle,this.currentStartX=0,this.currentStartY=0,this.displayRadius=1}configureCanvas(t){let{strokeWidth:e,strokeColor:s,fillColor:o,displayRadius:i}=t;return this._canvas.isDrawingMode=!1,this._canvas.selection=!1,this._canvas.forEachObject(t=>t.selectable=t.evented=!1),this.strokeWidth=e,this.strokeColor=s,this.fillColor=o,this.displayRadius=i,this._canvas.on("mouse:down",t=>this.onMouseDown(t)),this._canvas.on("mouse:move",t=>this.onMouseMove(t)),this._canvas.on("mouse:up",t=>this.onMouseUp(t)),this._canvas.on("mouse:out",t=>this.onMouseOut(t)),()=>{this._canvas.off("mouse:down"),this._canvas.off("mouse:move"),this._canvas.off("mouse:up"),this._canvas.off("mouse:out")}}onMouseDown(t){let e=this._canvas,s=t.e.button;this.isMouseDown=!0;let o=e.getPointer(t.e);this.currentStartX=o.x-(this.displayRadius+this.strokeWidth/2),this.currentStartY=o.y,this.currentCircle=new c.fabric.Circle({left:this.currentStartX,top:this.currentStartY,originX:"left",originY:"center",strokeWidth:this.strokeWidth,stroke:this.strokeColor,fill:this.fillColor,selectable:!1,evented:!1,radius:this.displayRadius}),0===s&&e.add(this.currentCircle)}onMouseMove(t){if(!this.isMouseDown)return;let e=this._canvas;this.currentCircle.setCoords(),e.renderAll()}onMouseUp(t){this.isMouseDown=!1}onMouseOut(t){this.isMouseDown=!1}}};var E=Object(a.b)(t=>{let{args:e}=t;const{canvasWidth:s,canvasHeight:n,backgroundColor:r,backgroundImageURL:l,realtimeUpdateStreamlit:u,drawingMode:d,fillColor:f,strokeWidth:v,strokeColor:k,displayRadius:b,initialDrawing:m,displayToolbar:w,scaleFactors:p,axes_and_labels:S}=e,[M,_]=Object(o.useState)(new c.fabric.Canvas(""));M.stopContextMenu=!0,M.fireRightClick=!0;const[A,x]=Object(o.useState)(new c.fabric.StaticCanvas("")),{canvasState:{action:{shouldReloadCanvas:D,forceSendToStreamlit:L},currentState:W,initialState:O},saveState:R,undo:T,redo:j,canUndo:E,canRedo:U,forceStreamlitUpdate:X,resetState:Y}=Object(o.useContext)(y);Object(o.useEffect)(()=>{const t=new c.fabric.Canvas("canvas",{enableRetinaScaling:!1}),e=new c.fabric.StaticCanvas("backgroundimage-canvas",{enableRetinaScaling:!1});_(t),x(e),a.a.setFrameHeight()},[]),Object(o.useEffect)(()=>{Object(h.isEqual)(O,m)||M.loadFromJSON(m,()=>{M.renderAll(),Y(m)})},[M,m,O,Y]),Object(o.useEffect)(()=>{if(l){var t,e=new Image;e.onload=function(){A.getContext().drawImage(e,0,0)};const s=null!==(t=function(){const t=new URLSearchParams(window.location.search).get("streamlitUrl");if(null==t)return null;try{return new URL(t).origin}catch{return null}}())&&void 0!==t?t:"";e.src=s+l}},[M,A,n,s,r,l,R]),Object(o.useEffect)(()=>{D&&M.loadFromJSON(W,()=>{})},[M,D,W]),Object(o.useEffect)(()=>{const t=new P[d](M).configureCanvas({fillColor:f,strokeWidth:v,strokeColor:k,displayRadius:b,scaleFactors:p,canvasHeight:n,canvasWidth:s,axes_and_labels:!1});return M.on("mouse:up",t=>{R(M.toJSON()),3===t.button&&X()}),M.on("mouse:dblclick",()=>{R(M.toJSON())}),()=>{t(),M.off("mouse:up"),M.off("mouse:dblclick")}},[M,v,k,b,f,d,m,p,S,n,s,R,X]);const[F,B]=Object(o.useState)(!1);return Object(o.useEffect)(()=>{if(S&&!F){const t=[],e=new c.fabric.Rect({left:p[3],top:p[4],fill:"transparent",stroke:"black",width:s-p[3]-p[5],height:n-p[2]-p[4],selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0});t.push(e);const o=p[3],i=p[4],r=s-p[3]-p[5],a=n-p[2]-p[4];for(let s=0;s<=10;s++){const e=i+s*a/10,n=new c.fabric.Line([o-5,e,o,e],{stroke:"black",selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0}),h=new c.fabric.Text((p[1]-s*p[1]/10).toString(),{left:o-35,top:e-10,fontSize:20,fill:"black",selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0}),l=new c.fabric.Line([o,e,o+r,e],{stroke:"lightgray",selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0});t.push(n,h,l)}for(let s=0;s<=10;s++){const e=o+s*r/10,n=new c.fabric.Line([e,i+a,e,i+a+5],{stroke:"black",selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0}),h=new c.fabric.Text((s*p[0]/10).toString(),{left:e-7,top:i+a+10,fontSize:20,fill:"black",selectable:!1,evented:!1,hasControls:!1}),l=new c.fabric.Line([e,i,e,i+a],{stroke:"lightgray",selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0});t.push(n,h,l)}const h=new c.fabric.Text("Quantity, Q",{left:o+r/2,top:i+a+40,fontSize:24,fontStyle:"italic",fill:"black",originX:"center",selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0});t.push(h);const l=new c.fabric.Text("Price, P",{left:o-65,top:i+a/2,fontSize:24,fontStyle:"italic",fill:"black",originX:"center",originY:"center",angle:-90,selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0});t.push(l);const u=t.shift();t.push(u),u instanceof c.fabric.Rect&&u.set({fill:""});const d=t.filter(t=>void 0!==t),f=new c.fabric.Group(d,{selectable:!1,evented:!1,hasControls:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0});M.add(f),M.renderAll(),B(!0)}},[S,M,s,n,F,p]),i.a.createElement("div",{style:{position:"relative"}},i.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:-10,visibility:"hidden"}},i.a.createElement(C,{canvasHeight:n,canvasWidth:s,shouldSendToStreamlit:u||L,stateToSendToStreamlit:W})),i.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:0}},i.a.createElement("canvas",{id:"backgroundimage-canvas",width:s,height:n})),i.a.createElement("div",{style:{position:"absolute",top:0,left:0,zIndex:10}},i.a.createElement("canvas",{id:"canvas",width:s,height:n,style:{border:"lightgrey 1px solid"}})),w&&i.a.createElement(g,{topPosition:n,leftPosition:s,canUndo:E,canRedo:U,downloadCallback:X,undoCallback:T,redoCallback:j,resetCallback:()=>{Y(O)}}))});s(101);r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(D,null,i.a.createElement(E,null))),document.getElementById("root"))},14:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAwwAAAMMBnc7+MwAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEFSURBVEiJ7dSxLkRBFMbx31BIlkQlHoCap5BQLAXvQafV6DyLRLYSdkWv0dBQ0NAKkUhkj2bEzc3udW9xE5E9yVfNd85/5pyZSRGhzZhqtfoE8DcAKaVOqwD0mkBSSnNNAAmBAboR8V4qtoguVrNWMI9n3Gad4SQqHlRk9dHJvmns4qWwXqUrbESEspSMfazhekyhN9zhc8z6KWarAKN0jm0sI+WkmdyuPTyV/JdFSBXgATujjl3aYQf7+CjkXhTaPRYw+DbVETZLkMM6Leo3hGxhmHNfsVBnBk0hx4XcozqARpA8/GG+bQcJ6+rFTUQ81jGmlJYi4p6fa9da/IPvegL4Lb4A0uc9nRaYXwcAAAAASUVORK5CYII="},27:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAhQAAAIUB4uz/wQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAHUSURBVEiJtda9ahRRFAfw3xHFJCabFEkawcYiYKMWVmohBHwFOwsfQLCxthOENHZqKxZG8DHSxcJC0Qcw7AqSNSoGci3mznp3nP0K8cBlZs7X/5z//RopJeMGlrGL1Bi7WJ4Uf9pk2cQVPMDPrJvHVra9GRc8BBARS7iKU4X6cn5+wvf8vljbIuJr4XuEdyml/YGmoGIdX/xLxayji/U2iu5iJXfwa1zbY2QOOznXE4YpuoE93D5m8lr2cLMN4BWu4TF+4HDGxIEOeng90DaW5BkVj/fyd6dhP4u5hq6Tnxdz7GZpL1eLlNIhvmEtq7Yj4mHhsoWng5Ir23b+rGO6Zc62fdAtnFewUdjOqyaylo3sMxJgqIMsvcJ5X8XrKFlCvwHQmwRQdjArwH5K6fc0AKvHAFjVoGcUwCwUdbKPHNNrOpw0RVN10MVCRCz8T4A6oI/FiIiTBKh5XFN1EDnRkETEnGrnH2sOSoC60rbqoR8R8zg3bQe102oB0DYPAwB/l/VkgJTSgeo+KDtoA6h1fSN2Me1nUV3JOj7iOT5k/csi5jNe4D2uj+og8lE7rIx4hjt4hIMRRZRyX7UYLqWUjoYsI35VLuCt6tKZ5h7ewa22XH8AgjMTispa6ucAAAAASUVORK5CYII="},28:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAsQAAALEBxi1JjQAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAEYSURBVEiJ7dS9SgNBFMXxX0y0NNpLqjQiKRRETON7aBMfwLfxDcRGC8HOTm21s7RIYZdniGiRO+6y5mNXVxD0wMBw58z532Fnh1+kFq5jNH8C0MFbjE7ZTUsVAEsz5rUBvqR/wB8CNLFeY+5aZH4ArjDCXsHYNv+vbWK1UNuNrMs8oGfyFGzmjDthvA9QUe1YG4U3aQvL2M4DpqkRHfZxU4C0o9aPxhpzcsDQ5I0ZFOpHGMfas+wtSvNxePIaxNpw0QngHIcR1M3Vu3jFcXhmqsw1vZCdJCmFny3a3CoBSBAm3TbKhlcBJEj6Vo9lN1UBwENF/yfAAVaqhhS0P614J7uCdY1bsh+kh1NsfLP7pBec4KmmvNl6B0BuQt0zCQ0xAAAAAElFTkSuQmCC"},86:function(t,e,s){t.exports=s(102)},97:function(t,e){},98:function(t,e){},99:function(t,e){}},[[86,1,2]]]);
//# sourceMappingURL=main.f1436e50.chunk.js.map